SET(DEMO_SRC_DIR ${ROOT_SRC_DIR}/demo)

AUX_SOURCE_DIRECTORY(${DEMO_SRC_DIR} DEMO_SRCS)

ADD_EXECUTABLE(${PROJECT_NAME} ${DEMO_SRCS})
TARGET_LINK_LIBRARIES(${PROJECT_NAME} ${REQUIRED_PKGS_LDFLAGS} -pie)

INSTALL(TARGETS ${PROJECT_NAME} DESTINATION ${BINDIR})

# Internationalization

SET(PO_DIR ${DEMO_SRC_DIR}/po)

FILE(GLOB PO_FILES RELATIVE "${PO_DIR}" "${PO_DIR}/*.po")

SET(MSGFMT "/usr/bin/msgfmt")

FOREACH(PO_FILE ${PO_FILES})
        SET(PO_FILE ${PO_DIR}/${PO_FILE})
        MESSAGE("PO: ${PO_FILE}")
        GET_FILENAME_COMPONENT(ABS_PO_FILE ${PO_FILE} ABSOLUTE)
        GET_FILENAME_COMPONENT(lang ${ABS_PO_FILE} NAME_WE)
        SET(MO_FILE ${PO_DIR}/${lang}.mo)
        ADD_CUSTOM_COMMAND(OUTPUT ${MO_FILE}
                           COMMAND ${MSGFMT} -o ${MO_FILE} ${ABS_PO_FILE}
                           DEPENDS ${ABS_PO_FILE})
        INSTALL(FILES ${MO_FILE} DESTINATION ${LOCALE_DIR}/${lang}/LC_MESSAGES RENAME ${PROJECT_NAME}.mo)
        SET(MO_FILES ${MO_FILES} ${MO_FILE})
ENDFOREACH(PO_FILE)

MESSAGE(".mo files: ${MO_FILES}")
ADD_CUSTOM_TARGET(po ALL DEPENDS ${MO_FILES})
